{% extends 'base_usuarios.html' %}
{% block content %}
<main class="w-screen h-screen bg-white dark:bg-black-ui-900 overflow-y-auto">
    <section class="p-4 flex flex-col gap-2 sm:gap-0 sm:justify-between sm:flex-row text-black dark:text-white">
        <h1 class="font-sans font-semibold text-3xl ">Lista de Tareas</h1>
        <button id="btn-crear-task-list" type="button"
                class=" font-inter font-normal text-center py-2 px-4 rounded-md bg-torch-red-500 hover:bg-torch-red-600 active:bg-torch-red-700 w-32 sm:w-fit">Crear
            Lista</button>
    </section>
    <!-- Mensajes -->
    <div id="message-loader">

    </div>


    <section id="task-list-container" class="px-4 dark:text-gray-100">
        {% if task_lists %}
        {% for task_list in task_lists %}
        <article id="task-list-item" class="w-full p-3 my-2 bg-torch-red-200 rounded-lg relative hover:scale-y-105 hover:cursor-pointer"
                 data-id={{task_list.id}}
                 data-name="{{task_list.name}}"
                 data-description="{{task_list.description}}">
            <div class="absolute w-1.5 top-0 bottom-0 left-0 bg-torch-red-600"></div>
            <div class="flex flex-col gap-2 sm:justify-between sm:flex-row sm:gap-0">
                <header>
                    <h1 id="h_article_task_{{ task_list.id }}" class="text-torch-red-950 text-base">{{ task_list.name }}</h1>
                    <p id="p_article_task_created_{{ task_list.id }}" class="text-torch-red-900 text-xs"> <strong>Created: </strong>
                        {{ task_list.created|date:'F d, Y'}}</p>
                    <p id="p_article_task_totaltask_{{ task_list.id }}" class="text-torch-red-900 text-xs"><strong>Total Tasks:
                        </strong>{{ task_list.total_tasks }}</p>
                    <p id="p_article_task_completedtask_{{ task_list.id }}" class="text-torch-red-900 text-xs"><strong>Completed Tasks:
                        </strong>{{ task_list.completed_tasks }}</p>
                </header>
                <!--Buttons to create new task inside or delete the list itself-->
                <section class="flex items-center gap-1">
                    <button id="btn-add-new-task" type="button"
                            class="font-inter font-normal text-center px-2 py-1 rounded-md bg-transparent hover:scale-125" data-id={{task_list.id}}>
                        <svg class="w-6 h-6 text-gray-800  hover:text-green-500 active:text-green-600 dark:hover:text-green-500 dark:active:text-green-600"
                             aria-hidden="true"
                             xmlns="http://www.w3.org/2000/svg" width="24"
                             height="24" fill="none" viewBox="0 0 24 24">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M12 21a9 9 0 1 1 0-18c1.052 0 2.062.18 3 .512M7 9.577l3.923 3.923 8.5-8.5M17 14v6m-3-3h6" />
                        </svg>
                    </button>
                    <button id="btn-update-task-list" type="button"
                            class="font-inter font-normal text-center px-2 py-1 rounded-md bg-transparent hover:scale-125" data-id={{task_list.id}}>
                        <svg class="w-6 h-6 text-gray-800 hover:text-sky-500 active:text-sky-600 dark:hover:text-sky-500 dark:active:text-sky-600"
                             aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24"
                             height="24" fill="none" viewBox="0 0 24 24">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="m14.304 4.844 2.852 2.852M7 7H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1v-4.5m2.409-9.91a2.017 2.017 0 0 1 0 2.853l-6.844 6.844L8 14l.713-3.565 6.844-6.844a2.015 2.015 0 0 1 2.852 0Z" />
                        </svg>

                    </button>
                    <button id="btn-delete-task-list" type="button"
                            class="font-inter font-normal text-center px-2 py-1 rounded-md bg-transparent hover:scale-125" data-id={{task_list.id}}>
                        <svg class="w-6 h-6 text-gray-800  hover:text-torch-red-500 active:text-torch-red-600 dark:hover:text-torch-red-500 dark:hover:active:text-torch-red-600"
                             aria-hidden="true"
                             xmlns="http://www.w3.org/2000/svg" width="24"
                             height="24" fill="none" viewBox="0 0 24 24">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M5 7h14m-9 3v8m4-8v8M10 3h4a1 1 0 0 1 1 1v3H9V4a1 1 0 0 1 1-1ZM6 7h12v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7Z" />
                        </svg>
                    </button>
                </section>
            </div>
            <!--Description of the list-->
            <section class="py-1">
                <p id="description_task_{{ task_list.id }}" class="text-gray-700 py-2 border-t-2 border-torch-red-400">
                    {{ task_list.description }}
                </p>
            </section>
        </article>
        {% endfor %}
        {% else %}
        <article class="w-full p-3 my-2 relative flex justify-center items-center bg-torch-red-200 rounded-lg">
            <p>There is not task list available, add a new one </p>
            <button id="btn-create-not-task-list" type="button"
                    class="font-inter font-normal text-center px-2 py-1 rounded-md bg-transparent hover:scale-125">
                <svg class="w-6 h-6 text-gray-800  hover:text-green-500 active:text-green-600 dark:hover:text-green-500 dark:active:text-green-600"
                     aria-hidden="true"
                     xmlns="http://www.w3.org/2000/svg" width="24"
                     height="24" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M12 21a9 9 0 1 1 0-18c1.052 0 2.062.18 3 .512M7 9.577l3.923 3.923 8.5-8.5M17 14v6m-3-3h6" />
                </svg>
            </button>
        </article>
        {% endif %}
    </section>
</main>
<!--Modal create Task_List-->
<div id="create-task-list-modal" tabindex="-1" aria-hidden="true"
     class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 w-full md:inset-0 h-[calc(100%-1rem)] max-h-full bg-black bg-opacity-40">
    <div class="relative p-4 w-full max-w-2xl max-h-full mx-auto">
        <!--Modal content-->
        <div class="relative bg-white rounded-lg dark:bg-gray-700">
            <!--Modal Header-->
            <div class="flex items-center justify-between p-4 sm:p-5 border-b rounded-t dark:border-gray-600">
                <h1 class="text-xl font-semibold text-gray-900 dark:text-white">New Task List</h1>
                <button id="btn-close-svg" type="button"
                        class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
                        data-modal-hide="default-modal">
                    <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <div id="message-modal-create"></div>
            <!-- Modal body-->
            <div class="p-4 sm:p-5 space-y-4">
                <form action="{% url 'create_task_list'%}" method="post" id="crear_task_list_form">
                    {% csrf_token %}
                    {% for field in create_task_list_form %}
                    <label for="{{field.id_for_label}}" class="block mb-2">
                        <span class="text-gray-700 dark:text-gray-50">{{field.label}}</span>
                        {{field}}
                        {% if field.errors %}
                        <ul>
                            {% for error in field.errors %}
                            <li class="text-red-500">{{error}}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </label>
                    {% endfor %}
                </form>
            </div>
            <!--Modal Footer-->
            <div class="flex items-center p-4 sm:p-5 border-t border-gray-200 rounded-b dark:border-gray-600">
                <button id="btn-save" type="submit" for="crear_task_list_form"
                        class="text-white bg-torch-red-500 hover:bg-torch-red-600 active:bg-torch-red-700 focus:ring-4 focus:outline-none focus:ring-torch-red-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-torch-red-500 dark:hover:bg-torch-red-600 dark:active:bg-torch-red-700">Save</button>
                <button id="btn-footer-close" type="button"
                        class="py-2.5 px-5 ms-3 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-torch-red-700 focus:z-10 focus:ring-4 focus:ring-gray-100 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700">Close</button>
            </div>
        </div>
    </div>
</div>

<!--Modal update Task_List-->
<div id="update-task-list-modal" tabindex="-1" aria-hidden="true"
     class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 w-full md:inset-0 h-[calc(100%-1rem)] max-h-full bg-black bg-opacity-40">
    <div class="relative p-4 w-full max-w-2xl max-h-full mx-auto">
        <!--Modal content-->
        <div class="relative bg-white rounded-lg dark:bg-gray-700">
            <!--Modal Header-->
            <div class="flex items-center justify-between p-4 sm:p-5 border-b rounded-t dark:border-gray-600">
                <h1 class="text-xl font-semibold text-gray-900 dark:text-white">Update Task List</h1>
                <button id="btn-update-close-svg" type="button"
                        class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
                        data-modal-hide="default-modal">
                    <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <!-- Modal body-->
            <div class="p-4 sm:p-5 space-y-4">
                <form id="update_task_list_form">
                    {% csrf_token %}
                    {% for field in update_task_list_form %}
                    <label for="{{field.id_for_label}}" class="block mb-2">
                        <span class="text-gray-700 dark:text-gray-50">{{field.label}}</span>
                        {{field}}
                        {% if field.errors %}
                        <ul>
                            {% for error in field.errors %}
                            <li class="text-red-500">{{error}}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </label>
                    {% endfor %}
                </form>
            </div>
            <!--Modal Footer-->
            <div class="flex items-center p-4 sm:p-5 border-t border-gray-200 rounded-b dark:border-gray-600">
                <button id="btn-update-save" type="button" for="update_task_list_form"
                        class="text-white bg-torch-red-500 hover:bg-torch-red-600 active:bg-torch-red-700 focus:ring-4 focus:outline-none focus:ring-torch-red-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-torch-red-500 dark:hover:bg-torch-red-600 dark:active:bg-torch-red-700">Save</button>
                <button id="btn-update-footer-close" type="button"
                        class="py-2.5 px-5 ms-3 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-torch-red-700 focus:z-10 focus:ring-4 focus:ring-gray-100 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700">Close</button>
            </div>
        </div>
    </div>
</div>

<!--Modal confirmar eliminar Task_List-->
<div id="delete-task-list-modal" tabindex="-1" aria-hidden="true"
     class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 w-full md:inset-0 h-[calc(100%-1rem)] max-h-full bg-black bg-opacity-40">
    <div class="p-4 w-full h-full flex justify-center items-center">
        <!--Modal content-->
        <div class="relative bg-white rounded-lg dark:bg-gray-700">
            <!--Modal Header-->
            <div class="flex items-center justify-between p-4 sm:p-5 border-b rounded-t dark:border-gray-600">
                <h1 class="text-xl font-bold text-gray-900 dark:text-white">Confirmation Delete</h1>
                <button id="btn-delete-close-svg" type="button"
                        class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
                        data-modal-hide="default-modal">
                    <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <!-- Modal body-->
            <div class="p-4 sm:p-5 space-y-4">
                <p class="text-gray-900 dark:text-gray-50">Are you sure you want to delete this task list?</p>
                <p class="text-gray-400 dark:text-gray-200 text-sm"> This action will delete every task inside</p>
            </div>
            <!--Modal Footer-->
            <div class="flex items-center p-4 sm:p-5 border-t border-gray-200 rounded-b dark:border-gray-600">
                <button id="btn-delete-save" type="button"
                        class="py-2.5 px-5  text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-torch-red-700 focus:z-10 focus:ring-4 focus:ring-gray-100 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700">Yes</button>

                <button id="btn-delete-footer-close" type="button"
                        class="text-white bg-torch-red-500 hover:bg-torch-red-600 active:bg-torch-red-700 focus:ring-4 focus:outline-none focus:ring-torch-red-300 font-medium rounded-lg text-sm px-5 py-2.5 ms-3 text-center dark:bg-torch-red-500 dark:hover:bg-torch-red-600 dark:active:bg-torch-red-700">No</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal add new task to task_list-->
<div id="add_task_to_task_list-modal" tabindex="-1" aria-hidden="true"
     class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 w-full md:inset-0 h-[calc(100%-1rem)] max-h-full bg-black bg-opacity-40">
    <div class="p-4 w-full max-w-2xl max-h-full mx-auto">
        <!--Modal content-->
        <div class="relative bg-white rounded-lg dark:bg-gray-700">
            <!--Modal Header-->
            <div class="flex items-center justify-between p-4 sm:p-5 border-b rounded-t dark:border-gray-600">
                <h1 class="text-xl font-bold text-gray-900 dark:text-white">New Task</h1>
                <button id="btn-add-task-close-svg" type="button"
                        class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
                        data-modal-hide="default-modal">
                    <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <!-- Modal body-->
            <div class="p-4 sm:p-5 space-y-4">
                <form method="post" id="add_task_to_task_list_form">
                    {% csrf_token %}
                    {% for field in add_task_to_task_list_form %}
                    <label for="{{field.id_for_label}}" class="block mb-2">
                        <span class="text-gray-700 dark:text-gray-50">{{field.label}}</span>
                        {{field}}
                        {% if field.errors %}
                        <ul>
                            {% for error in field.errors %}
                            <li class="text-red-500">{{error}}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </label>
                    {% endfor %}
                    <!--Modal Footer-->
                    <div class="flex items-center p-4 sm:p-5 border-t border-gray-200 rounded-b dark:border-gray-600">
                        <button id="btn-add-task-save" type="button"
                                class="text-white bg-torch-red-500 hover:bg-torch-red-600 active:bg-torch-red-700 focus:ring-4 focus:outline-none focus:ring-torch-red-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-torch-red-500 dark:hover:bg-torch-red-600 dark:active:bg-torch-red-700">Save</button>

                        <button id="btn-add-task-footer-close" type="button"
                                class="py-2.5 px-5 ms-3 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-torch-red-700 focus:z-10 focus:ring-4 focus:ring-gray-100 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700">Close</button>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>


{% endblock %}

{% block scripts %}
<!-- Script para poner un maximo de palabra visible-->
<!--<script>
    let descriptionLists = document.querySelectorAll('#description-list');

    function truncateDescription() {
        descriptionLists.forEach((descriptionList) => {
            // Check if the full text is already stored
            if (!descriptionList.getAttribute('data-full-text')) {
                descriptionList.setAttribute('data-full-text', descriptionList.innerText);
            }

            let description = descriptionList.getAttribute('data-full-text');
            let maxLength;
            if (window.innerWidth <= 640) {
                maxLength = 150;
            } else {
                maxLength = 250;
            }

            let shortDescription = description.substring(0, maxLength);

            if (description.length > maxLength) {
                descriptionList.innerText = shortDescription + '...';
            }
        });
    }
    // Call the function once when the page loads
    truncateDescription();

    // Call the function again whenever the window is resized
    window.addEventListener('resize', truncateDescription);
</script>-->

<!--Script abrir modal crear_task_list-->
<script>
    //Obtener boton crear_Task_list
    const btn_crear = document.getElementById('btn-crear-task-list');
    const btn_crear_not_task_list = document.getElementById('btn-create-not-task-list');

    //Obtener modal crear_task_list
    const modal_crear = document.getElementById('create-task-list-modal');
    const modal_close_svg = document.getElementById('btn-close-svg');
    const modal_close_btn = document.getElementById('btn-footer-close');

    // Agregando eventlistener para cerrar el modal_crear
    modal_crear.addEventListener('click', (e) => {
        if (e.target === modal_crear || e.target === modal_close_btn || e.target === modal_close_svg) {
            hide_modal(modal_crear);
        }
    });

    btn_crear.addEventListener('click', () => {
        modal_crear.classList.remove('hidden');
        modal_crear.classList.add('block');
        modal_crear.setAttribute('aria-hidden', 'false');
    });


    if (btn_crear_not_task_list) {
        btn_crear_not_task_list.addEventListener('click', () => {
            modal_crear.classList.remove('hidden');
            modal_crear.classList.add('block');
            modal_crear.setAttribute('aria-hidden', 'false');
        });
    }

    // Submit the form when the "Save" button is clicked -- Get the form element
    const form = document.getElementById('crear_task_list_form');

    // Get the "Save" button element
    const saveButton = document.getElementById('btn-save');

    // Add click event listener to the "Save" button
    saveButton.addEventListener('click', function (e) {
        // Prevent the default form submission
        e.preventDefault();
        // Disable the button while the form is being submitted
        saveButton.disabled = true;

        // Obtener los valores de los campos del formulario
        const name = form.querySelector('#id_name').value;
        const description = form.querySelector('#id_description').value;

        // Verificar si los valores están vacíos
        if (name.trim() === '' || description.trim() === '') {
            show_message_modal_crear('All fields are required', 'error');
            saveButton.disabled = false;  // Habilitar el botón nuevamente
            return;  // Detener la ejecución de la función
        }


        fetch(form.action, {
            method: 'POST',
            body: new FormData(form),
            headers: {
                'X-CSRFToken': '{{csrf_token}}'
            }
        }).then(response => {
            if (response.ok) {
                form.reset();
                hide_modal(modal_crear);
                //show_message('Task List Created', 'success');
                response.json().then(data => {
                    /*if (data.exist_one) {
                        window.location.reload();
                    }*/
                    window.location.reload();
                    /*const taskListContainer = document.getElementById('task-list-container');
                    const article = document.createElement('article');
                    article.className = 'w-full p-3 my-2 bg-torch-red-200 rounded-lg relative';
                    article.setAttribute('data-id', data.id);
                    article.setAttribute('data-name', data.name);
                    article.setAttribute('data-description', data.description);
                    const div_absolute = document.createElement('div');
                    div_absolute.className = 'absolute w-1.5 top-0 bottom-0 left-0 bg-torch-red-600';
                    const div_flex = document.createElement('div');
                    div_flex.className = 'flex flex-col gap-2 sm:justify-between sm:flex-row sm:gap-0';
                    const header = document.createElement('header');
                    const h1 = document.createElement('h1');
                    h1.id = `h_article_task_${data.id}`;
                    h1.className = 'text-torch-red-950 text-base';
                    h1.textContent = data.name;
                    const p_created = document.createElement('p');
                    p_created.id = `p_article_task_created_${data.id}`;
                    p_created.className = 'text-torch-red-900 text-xs';
                    p_created.innerHTML = `<strong>Created: </strong>${data.created}`;
                    const p_total_task = document.createElement('p');
                    p_total_task.id = `p_article_task_totaltask_${data.id}`;
                    p_total_task.className = 'text-torch-red-900 text-xs';
                    p_total_task.innerHTML = `<strong>Total Tasks: </strong>${data.total_tasks}`;
                    const p_completed_task = document.createElement('p');
                    p_completed_task.id = `p_article_task_completedtask_${data.id}`;
                    p_completed_task.className = 'text-torch-red-900 text-xs';
                    p_completed_task.innerHTML = `<strong>Completed Tasks: </strong>${data.completed_tasks}`;
                    const section_buttons = document.createElement('section');
                    section_buttons.className = 'flex items-center gap-1';
                    const btn_add_new_task = document.createElement('button');
                    btn_add_new_task.id = 'btn-add-new-task';
                    btn_add_new_task.type = 'button';
                    btn_add_new_task.className = 'font-inter font-normal text-center px-2 py-1 rounded-md bg-transparent hover:scale-125';
                    btn_add_new_task.setAttribute('data-id', data.id);
                    btn_add_new_task.innerHTML = `<svg class="w-6 h-6 text-gray-800  hover:text-green-500 active:text-green-600 dark:hover:text-green-500 dark:active:text-green-600" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 21a9 9 0 1 1 0-18c1.052 0 2.062.18 3 .512M7 9.577l3.923 3.923 8.5-8.5M17 14v6m-3-3h6" /></svg>`;
                    const btn_update_task_list = document.createElement('button');
                    btn_update_task_list.id = 'btn-update-task-list';
                    btn_update_task_list.type = 'button';
                    btn_update_task_list.className = 'font-inter font-normal text-center px-2 py-1 rounded-md bg-transparent hover:scale-125';
                    btn_update_task_list.setAttribute('data-id', data.id);
                    btn_update_task_list.innerHTML = `<svg class="w-6 h-6 text-gray-800 hover:text-sky-500 active:text-sky-600 dark:hover:text-sky-500 dark:active:text-sky-600" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m14.304 4.844 2.852 2.852M7 7H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1v-4.5m2.409-9.91a2.017 2.017 0 0 1 0 2.853l-6.844 6.844L8 14l.713-3.565 6.844-6.844a2.015 2.015 0 0 1 2.852 0Z" /></svg>`;
                    const btn_delete_task_list = document.createElement('button');
                    btn_delete_task_list.id = 'btn-delete-task-list';
                    btn_delete_task_list.type = 'button';
                    btn_delete_task_list.className = 'font-inter font-normal text-center px-2 py-1 rounded-md bg-transparent hover:scale-125';
                    btn_delete_task_list.setAttribute('data-id', data.id);
                    btn_delete_task_list.innerHTML = `<svg class="w-6 h-6 text-gray-800  hover:text-torch-red-500 active:text-torch-red-600 dark:hover:text-torch-red-500 dark:hover:active:text-torch-red-600" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 7h14m-9 3v8m4-8v8M10 3h4a1 1 0 0 1 1 1v3H9V4a1 1 0 0 1 1-1ZM6 7h12v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7Z" /></svg>`;
                    const section_description = document.createElement('section');
                    section_description.className = 'py-1';
                    const p_description = document.createElement('p');
                    p_description.id = `description_task_${data.id}`;
                    p_description.className = 'text-gray-700 py-2 border-t-2 border-torch-red-400';
                    p_description.textContent = data.description;

                    // Append the elements to the article
                    section_description.appendChild(p_description);
                    section_buttons.appendChild(btn_add_new_task);
                    section_buttons.appendChild(btn_update_task_list);
                    section_buttons.appendChild(btn_delete_task_list);

                    header.appendChild(h1);
                    header.appendChild(p_created);
                    header.appendChild(p_total_task);
                    header.appendChild(p_completed_task);

                    div_flex.appendChild(header);
                    div_flex.appendChild(section_buttons);

                    article.appendChild(div_absolute);
                    article.appendChild(div_flex);
                    article.appendChild(section_description);

                    taskListContainer.appendChild(article);*/

                }).catch(error => {
                    console.log('Error catch response json');
                });
            } else {
                handleError('Error creating Task List', saveButton);
            }
            saveButton.disabled = false;
        }).catch(error => {
            handleError('Error creating Task List', saveButton);
        });
    });

    // Funcion para mostrar mensaje de exito o error
    function show_message(message, type) {
        if (type === 'success') {
            const message_loader = document.getElementById('message-loader');
            const div = document.createElement('div');
            div.id = "alert-3"
            div.className = 'flex items-center p-4 mb-4 text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-green-400';
            div.role = "alert"
            div.innerHTML = `<svg class="flex-shrink-0 w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20"><path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z" /></svg><span class="sr-only">Info</span><div class="ms-3 text-sm font-medium">${message}</div>`;
            message_loader.appendChild(div);
            setTimeout(() => {
                div.remove();
            }, 2000);
        } else if (type === 'error') {
            const message_loader = document.getElementById('message-loader');
            const div = document.createElement('div');
            div.id = "alert-2"
            div.className = 'flex items-center p-4 mb-4 text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400';
            div.role = "alert"
            div.innerHTML = `<svg class="flex-shrink-0 w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20"><path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z" /></svg><span class="sr-only">Info</span><div class="ms-3 text-sm font-medium">${message}</div>`;
            message_loader.appendChild(div);
            setTimeout(() => {
                div.remove();
            }, 2000);
        }
        else { // type warning or other type of message
            const message_loader = document.getElementById('message-loader');
            const div = document.createElement('div');
            div.id = "alert-4"
            div.className = 'flex items-center p-4 mb-4 text-yellow-800 rounded-lg bg-yellow-50 dark:bg-gray-800 dark:text-yellow-400';
            div.role = "alert"
            div.innerHTML = `<svg class="flex-shrink-0 w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20"><path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z" /></svg><span class="sr-only">Info</span><div class="ms-3 text-sm font-medium">${message}</div>`;
            message_loader.appendChild(div);
            setTimeout(() => {
                div.remove();
            }, 2000);
        }
    };

    // Funcion para mostrar mensaje de exito o error en el modal crear
    function show_message_modal_crear(message, type) {
        if (type === 'success') {
            const message_loader = document.getElementById('message-modal-create');
            const div = document.createElement('div');
            div.id = "alert-3"
            div.className = 'flex items-center p-4 mb-4 text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-green-400';
            div.role = "alert"
            div.innerHTML = `<svg class="flex-shrink-0 w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20"><path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z" /></svg><span class="sr-only">Info</span><div class="ms-3 text-sm font-medium">${message}</div>`;
            message_loader.appendChild(div);
            setTimeout(() => {
                div.remove();
            }, 2000);
        } else if (type === 'error') {
            const message_loader = document.getElementById('message-modal-create');
            const div = document.createElement('div');
            div.id = "alert-2"
            div.className = 'flex items-center p-4 mb-4 text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400';
            div.role = "alert"
            div.innerHTML = `<svg class="flex-shrink-0 w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20"><path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z" /></svg><span class="sr-only">Info</span><div class="ms-3 text-sm font-medium">${message}</div>`;
            message_loader.appendChild(div);
            setTimeout(() => {
                div.remove();
            }, 2000);
        }
        else { // type warning or other type of message
            const message_loader = document.getElementById('message-modal-create');
            const div = document.createElement('div');
            div.id = "alert-4"
            div.className = 'flex items-center p-4 mb-4 text-yellow-800 rounded-lg bg-yellow-50 dark:bg-gray-800 dark:text-yellow-400';
            div.role = "alert"
            div.innerHTML = `<svg class="flex-shrink-0 w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20"><path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z" /></svg><span class="sr-only">Info</span><div class="ms-3 text-sm font-medium">${message}</div>`;
            message_loader.appendChild(div);
            setTimeout(() => {
                div.remove();
            }, 2000);
        }
    };

</script>

<!-- Script abrir modal update_task_list-->
<script>
    // Obteniendo todos los botones update antes de agregarles los eventos onclick handle update
    let btn_update_collection = document.querySelectorAll('#btn-update-task-list');

    if (btn_update_collection) {
        btn_update_collection.forEach((btn) => {
            btn.addEventListener('click', updateTaskListsUI);
        });
    }

    // Obteniendo el boton de guardar del modal update_task_list
    const updateSaveButton = document.getElementById('btn-update-save');
    // Agregar evento para abrir el modal update_task_list
    const modal_update = document.getElementById('update-task-list-modal');
    const modal_update_close_svg = document.getElementById('btn-update-close-svg');
    const modal_update_close_btn = document.getElementById('btn-update-footer-close');
    // Agregado eventos para cerrar el modal_update_task_list
    modal_update.addEventListener('click', (e) => {
        if (e.target === modal_update || e.target === modal_update_close_btn || e.target === modal_update_close_svg) {
            hide_modal(modal_update);
        }
    });

    function updateTaskListsUI(event) {
        const id = event.currentTarget.getAttribute('data-id');

        // Cambiar display del modal update_task_list
        modal_update.classList.remove('hidden');
        modal_update.classList.add('block');
        modal_update.setAttribute('aria-hidden', 'false');

        // Obteniendo el articulo con el task_list_id
        const article = document.querySelector(`article[data-id="${id}"]`);

        // Obtener el formulario y cambiar el action
        const form = document.getElementById('update_task_list_form');
        form.action = `/tasks/update_task_list/${id}`;
        form.name.value = article.getAttribute('data-name');
        form.description.value = article.getAttribute('data-description');

        //Enviar formulario
        updateSaveButton.onclick = function (e) {
            e.preventDefault();
            // Deshabilitar el botón mientras se procesa la solicitud
            updateSaveButton.disabled = true;
            fetch(form.action + '/', {
                method: 'POST',
                body: new FormData(form),
                headers: {
                    'X-CSRFToken': '{{csrf_token}}'
                }
            }).then(response => {
                if (response.ok) {
                    hide_modal(modal_update);
                    form.reset();
                    show_message('Task List Updated', 'success');

                    fetch(`/tasks/get_task_list/${id}/`, {
                        method: 'GET',
                        headers: {
                            'X-CSRFToken': '{{csrf_token}}',
                        }
                    }).then(response => {
                        if (response.ok) {
                            return response.json();
                        } else {
                            handleError('Error fetching updated task lists', updateSaveButton);
                        }
                    }).then(data => {
                        // Obtener los datos a actualizar segun el id
                        const name_article = document.getElementById(`h_article_task_${id}`);
                        if (name_article) {
                            name_article.textContent = data.name;
                            article.setAttribute('data-name', data.name);
                        }
                        const description_article = document.getElementById(`description_task_${id}`);
                        if (description_article) {
                            description_article.textContent = data.description;
                            article.setAttribute('data-description', data.description);
                        }
                    }).catch(error => {
                        console.log('Error catch fetching updated task lists');
                    });

                } else {
                    handleError('Error updating Task List', updateSaveButton);
                }
                // Habilitar el botón después de que se complete la solicitud
                updateSaveButton.disabled = false;
            }).catch(error => {
                handleError('Error updating Task List', updateSaveButton);
            })
        };
    }

    // Funcion para ocultar(cerrar) el modal update
    function hide_modal(modal) {
        modal.classList.remove('block');
        modal.classList.add('hidden');
        modal.setAttribute('aria-hidden', 'true');
    }
    // Funcion para mostrar mensaje de exito o error
    function handleError(message, btn) {
        show_message(message, 'error');
        console.log('Error:', message);
        btn.disabled = false;
    }

    // Funciones para manejar el modal de eliminacion de task_list
    // Obteniendo todos los botones de eliminar antes de agregarles los eventos onclick handle delete
    let btn_delete_collection = document.querySelectorAll('#btn-delete-task-list');
    if (btn_delete_collection) {
        btn_delete_collection.forEach((btn) => {
            btn.addEventListener('click', handleDeleteTaskList);
        });
    }

    // Obteniendo el modal de confirmacion para eliminar task_list
    const modal_delete = document.getElementById('delete-task-list-modal');
    const modal_delete_close_svg = document.getElementById('btn-delete-close-svg');
    const modal_delete_close_btn = document.getElementById('btn-delete-footer-close');

    // Agregando eventlistener para ocultar el modal eliminar
    modal_delete.addEventListener('click', (e) => {
        if (e.target === modal_delete || e.target === modal_delete_close_btn || e.target === modal_delete_close_svg) {
            hide_modal(modal_delete);
        }
    });

    // Obteniendo el boton de confirmacion delete
    const delete_save_button = document.getElementById('btn-delete-save');

    function handleDeleteTaskList(event) {
        const taskId = event.currentTarget.getAttribute('data-id');

        // Abrir el modal de confirmacion para eliminar task_list
        modal_delete.classList.remove('hidden');
        modal_delete.classList.add('block');
        modal_delete.setAttribute('aria-hidden', 'false');

        // Evento para eliminar task_list si el usuario confirma

        delete_save_button.onclick = function (e) {
            e.preventDefault();
            // Deshabilitar el botón mientras se procesa la solicitud
            delete_save_button.disabled = true;
            fetch(`/tasks/delete_task_list/${taskId}/`, {
                method: 'DELETE',
                headers: {
                    'X-CSRFToken': '{{csrf_token}}'
                }
            }).then(response => {
                if (response.ok) {
                    hide_modal(modal_delete);
                    response.json().then(data => {
                        if (data.last_one) {
                            window.location.reload();
                        } else {
                            // Removing the task list from the UI
                            const article = document.querySelector(`article[data-id="${taskId}"]`);
                            article.remove();
                            show_message('Task List Deleted', 'success');
                        }
                    }).catch(error => {
                        handleError('Error catch response json', delete_save_button);
                    });

                } else {
                    handleError('Error deleting Task List', delete_save_button);
                }
                delete_save_button.disabled = false;
            }).catch(error => {
                handleError('Error deleting Task List', delete_save_button);
            });
        };
    }

</script>

<!--Script abrir modal add_task_to_task_list-->
<script>
    // Obteniendo todos boton add_new_task

    let btn_add_new_task = document.querySelectorAll('#btn-add-new-task');
    if (btn_add_new_task) {
        btn_add_new_task.forEach((btn) => {
            btn.addEventListener('click', (e) => {
                modal_add_task_to_task_list.classList.remove('hidden');
                modal_add_task_to_task_list.classList.add('block');
                modal_add_task_to_task_list.setAttribute('aria-hidden', 'false');
                addTaskToTaskList(e);
            });
        });
    }

    // Obteniendo modal add_task_to_task_list
    const modal_add_task_to_task_list = document.getElementById('add_task_to_task_list-modal');
    const modal_add_task_to_task_list_close_svg = document.getElementById('btn-add-task-close-svg');
    const modal_add_task_to_task_list_close_btn = document.getElementById('btn-add-task-footer-close');

    // Agregando eventlistener para cerrar el modal add_task_to_task_list
    modal_add_task_to_task_list.addEventListener('click', (e) => {
        if (e.target === modal_add_task_to_task_list || e.target === modal_add_task_to_task_list_close_btn || e.target === modal_add_task_to_task_list_close_svg) {
            hide_modal(modal_add_task_to_task_list);
        }
    });

    // Obteniendo el boton de guardar del modal add_task_to_task_list
    const add_task_save_button = document.getElementById('btn-add-task-save');
    // Obtener id del boton, modificar action formulario y luego onclick Enviar



    function addTaskToTaskList(event) {
        const taskListId = event.currentTarget.getAttribute('data-id');
        const form = document.getElementById('add_task_to_task_list_form');
        form.action = `/tasks/add_task_to_task_list/${taskListId}`;
        add_task_save_button.onclick = function (e) {
            e.preventDefault();
            // Deshabilitar el botón mientras se procesa la solicitud
            add_task_save_button.disabled = true;
            fetch(form.action + '/', {
                method: 'POST',
                body: new FormData(form),
                headers: {
                    'X-CSRFToken': '{{csrf_token}}'
                }
            }).then(response => {
                if (response.ok) {
                    hide_modal(modal_add_task_to_task_list);
                    form.reset();
                    window.location.reload();
                    //show_message('Task Added', 'success');
                } else {
                    handleError('Error adding Task', add_task_save_button);
                }
                // Habilitar el botón después de que se complete la solicitud
                add_task_save_button.disabled = false;
            }).catch(error => {
                handleError('Error adding Task', add_task_save_button);
            });
        };
    }




</script>

<!-- Script para abrir contenido de tareas de una task_list-->
<script>
    let articles = document.querySelectorAll('#task-list-item');

    articles.forEach(article => {
        article.addEventListener('click', (e) => {
            const taskListId = e.currentTarget.getAttribute('data-id');
            window.location.href = `/tasks/task_list/${taskListId}`;
        })
    })

</script>

{% endblock %}